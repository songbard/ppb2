---
output: html_document
editor_options: 
  chunk_output_type: inline
---

------------------------------------------------------------------------

title: 'Update of Script 1, Initial Data Wrangling of PPB Use of Force Data, to incorporate additional quarters of raw data from PPB.' author: "Jonathan Brown" output: html_document: df_print: paged

**IMPORTANT: SEARCH ON THE STRING, "UPDATE", TO FIND SPOTS IN THIS PROGRAM THAT MUST BE CHANGED IN ORDER TO PROCESS A NEW CUMMULATIVE RAW DATASET.**

**VERY IMPORTANT: TO ENABLE SIDE BY SIDE COMPARISON WITH PREVIOUS VERSIONS OF THE RAW DATA, YOU MUST UPDATE THE ppb_force DATASET NAME TO ppb_forceQYY, where Q IS THE LASTEST QUARTER OF DATA IN THE DATASET AND YY IS LATEST YEAR, EG ppbforce122. At end of script, the final permanent ppbforce_clean_122.csv needs to have its name updated as well. I believe all this can be done globally by replacing the string, "force122", with "forceQYY".**

**ALSO IMPORTANT: TO ALLOW COMPLETE PRINT-OUTS OF SOME VARS, WHICH FACILITATES COMPARISON TO DETECT CHANGES MADE TO NEWER DATA SPECS, THIS SCRIPT CREATES TEMP DATASETS, LIKE caldet122, THAT SHOULD BE REMOVED IMMEDIATELY AFTER CREATION. BUT, FOR SAFETY, THE qyy SUFFIXES SHOULD STILL PROB BE UPDATED BECAUSE YOU WILL BE COMPARING SIMULTANEOUSLY TO PREVIOUS VERSIONS OF THE SCRIPT, ALL OF WHICH USE THE SAME WORKING DIRECTORY.**

**WARNING: In this script, many data-wrangling code chunks permanently change the ppb_force122 dataset (or its successor) as you go along. So, if you run an upstream chunk without re-running the script from the top, it will look like the chunk worked again but actually the chunk had been applied previously so the it probably did nothing new. ALSO, DOWNSTREAM CHUNKS MIGHT ALSO HAVE RUN SO UNLESS YOU (1) RUN TO THE END OF THE ENTIRE SCRIPT, WHERE THE SCRIPT DELETES ppb_force122, or its successor; or (2), RUN THE SCRIPT FROM THE TOP TO WHERE YOU ARE WORKING, YOU WILL BE PROCESSING A MUCH-MODIFIED DATASET.**

**Terminology**

-   **interaction** \* A single use of force, such as a takedown or a taser shot, applied by one officer to one civilian.

-   **encounter** \* All the forceful interactions that occurred between one officer and one civilian at one time and place. This is the unit of analysis in the PPB use of force dataset.

-   **incident** \* The combination of all *encounters* between all involved officers and *one* civilian at the same time and place.

-   **event** \* The totality of all the *incidents* that occurred at the same time and place, that is, the sum of all forceful encounters with *all* civilians at a particular time and place.  UPDATE: I believe that PPB calls these "cases."

```{r}
library(tidyverse)
library(lubridate)
library(gmodels)
```

**Upload the Raw Data from PPB Website**

The PPB use of force dataset is available for download via the Dashboard for the PPB Use of Force Report at <https://public.tableau.com/views/ForceAuditReport/DownloadOpenData?%3AshowVizHome=no>. The PPB force dataset is updated quarterly about 45 days after the close of the previous quarter, according to the PPB website. These updates may include changes to previous quarters. Therefore, one must upload the entire dataset, not just the data for the new quarter(s).

```{r}
#This reads in the raw .csv use of force data as download from PPB website.
#UPDATE: When adding new data, enter a new filename for the updated dataset on the RHS of the next line:
UseOfForce <- read_csv("raw_ppb_force_thru_q1_2022.csv")
UseOfForce %>%
  summarise(n())
```

As of Q1 2022, N increased from 7255 to 7975. 720 new uses of force over 6 additional months.

**Variable Names - Raw .csv**

Let's take a look at the variable names (column headers) in the use of force dataset as downloaded (into a .csv file that I named "UseOfForce") from the PPB Open Data webpage:

```{r}
ls(UseOfForce)
```

These original variable names are not well suited to wrangling and analysis in R. We need brief, lower-case names with no special characters that follow R-useful naming conventions, such as using underscore for modifiers, \_f for factors, similar vars grouped together using identical early-character sequences, etc. The following code replaces the raw varnames. It also creates a new data.frame, which will be the one I continue to clean and modify, leaving the original downloaded .csv as is, with its original varnames.

```{r}
library(dplyr)
```

```{r}
ppb_force122 <- UseOfForce %>%  
  rename(
    threat_blunt_raw = "Blunt Object",                                                      
    incid_force_lev_raw = "Category of Force Event - Measured at Event Level",                   
    incid_disp_raw = "Disposition/Custody",                                                 
    incid_day_raw = "DOW",                                                                 
    threat_gun_raw = "Firearm",                                                             
    threat_gun_implied_raw = "Firearm - Implied",                                                   
    threat_gun_replica_raw = "Firearm - Replica",                                                   
    force1_raw = "Force Applied - 1",                                                   
    force2_raw = "Force Applied - 2",                                                   
    force3_raw = "Force Applied - 3",                                                   
    force4_raw = "Force Applied - 4",                                                   
    force5_raw = "Force Applied - 5",                                                   
    force6_raw = "Force Applied - 6",                                                   
    force7_raw = "Force Applied - 7",                                                   
    force8_raw = "Force Applied - 8",                                                   
    incid_sixhour_raw = "Hour (6Hr)",                                                          
    call_group_raw = "Initial Call Category",                                               
    call_detail_raw = "Initial Call type",                                                   
    threat_knife_raw = "Knife / Edged Weapon / Stabbing Instrument",                          
    civil_mental_raw = "Mental Health Crisis - Prior to Force, Perceived Lack of Compliance", 
    incid_month_raw = "Month",                                                               
    threat_biohaz_raw = "Needle / Spit / Bodily Fluids",                                       
    threat_unarmed_raw = "No weapon (unarmed)",                                                 
    officer_id_raw = "Officer",                                                             
    officer_precinct_raw = "Officer Precinct",                                                    
    officer_tenure_raw = "Officer Tenure",                                                      
    threat_other_raw = "Other Weapon",                                                        
    recordcount_1_raw = "Record Count...48",                                                   
    recordcount_2_raw = "Record Count...49",                                                   
    incid_id_raw = "Record ID",                                                           
    civil_id_raw = "Subject",                                                             
    civil_race_raw = "Subject - Race",                                                      
    civil_sex_raw = "Subject - Sex",                                                       
    civil_transient_raw = "Subject - Transient",                                                 
    civil_age_raw = "Subject Age",                                                
    civil_instance_raw = "Subject Instance",                                                    
    resist1_raw = "Subject Resistance - 1",                                              
    resist2_raw = "Subject Resistance - 2",                                              
    resist3_raw = "Subject Resistance - 3",                                              
    resist4_raw = "Subject Resistance - 4",                                              
    resist5_raw = "Subject Resistance - 5",                                              
    resist6_raw = "Subject Resistance - 6",                                              
    resist7_raw = "Subject Resistance - 7",                                              
    resist8_raw = "Subject Resistance - 8",                                              
    call_source_raw = "Type of Call",                                                        
    civil_etoh_raw = "Under the Influence of Alcohol - Prior to Force, Perceived Condition",
    civil_drug_raw = "Under the Influence of Drugs - Prior to Force, Perceived Condition",  
    threat_unused_weapon_raw = "Weapon Present or reported but not used or threatened use",           
    incid_year_raw = "Year"                                                                
  )
```

```{r}
ls(ppb_force122)
```

49 RESPONSE CATEGORIES. SAME AS Q3 2021.

**CREATE PERMANENT RAW PPB USE OF FORCE DATASET WITH UPDATED VARIABLE NAMES**

Note: Because PPB force datasets updated quarterly (and retroactively), "permanent" datasets should be identified by the quarter and year of their most recent data. ALSO, THE FOLLOWING CODE CHUNK MUST BE EDITED TO REFLECT THE NEW QUARTER AND YEAR WHENEVER THIS SCRIPT IS RUN ON NEW DATA. (to find code that needs quarterly modification, search on "update me")

**DATA INSPECTION AND CLEANING**

**"call_detail"**

```{r}
 ppb_force122$call_detail_raw[is.na(ppb_force122$call_detail_raw)] <- "UNKNOWN"
caldet122 <- ppb_force122 %>%
  group_by(call_detail_raw) %>%
  summarise(n()) 
```

```{r}
print.data.frame(caldet122)
remove(caldet122)
```

AS OF Q1 2022, 119 response categories, compared to 117 thru Q3 2021. WHAT ARE THE TWO NEW ONES? They are:

**COMMUNITY PROBLEM ORIENTED POLICING** and **RAPE - COLD(39A)**

Now create the permanent variable for analysis:

```{r}
ppb_force122$call_detail <- ppb_force122$call_detail_raw
```

```{r}
ppb_force122 %>%
    group_by(call_detail_raw, call_detail) %>%
    summarise(n())
```

**"call_group"**

```{r}
ppb_force122 %>%
  group_by(call_group_raw) %>%
  summarise(n())
```

117 values now collapsed down to 41. NO CHANGE FROM Q3 2022. Modifiers like "COLD," "PRIORITY," AND "\*H" have been combined. Again, 6 NAs, inherited presumably from *call_group_raw*. I will replace these with "unknown"

```{r}
ppb_force122$call_group_raw[is.na(ppb_force122$call_group_raw)] <- "UNKNOWN"
ppb_force122 %>%
  group_by(call_group_raw) %>%
  summarise(n())
```

Success! Now create the perm var:

```{r}
ppb_force122$call_group <- ppb_force122$call_group_raw
```

**"call_source"**

```{r}
ppb_force122 %>%
  group_by(call_source_raw) %>%
  summarise(n())
```

No NAs, SAME AS Q3 2022.

Convert to perm var:

```{r}
ppb_force122$call_source <- ppb_force122$call_source_raw
```

**"civil_age"**

Recode to NA every value that is blank, below age 7, and above age 99. This is about 2.1% of cases, comparable to the 2% that PPB show as "undetermined" on their dashboard.

```{r}
ppb_force122$civil_age_raw <- replace(ppb_force122$civil_age_raw, ppb_force122$civil_age_raw < 7, NA)
ppb_force122$civil_age_raw <- replace(ppb_force122$civil_age_raw, ppb_force122$civil_age_raw >= 99, NA)

#nextline sorts by age.  if want descending, type - before varname.  can list multiple sorting vars.
ppb_force122 <- ppb_force122[order (ppb_force122$civil_age_raw),]

#shows the last 200 rows, most of which should be NAs, and the remainder the oldest civilians
tail(ppb_force122$civil_age_raw, n = 200L)
```

40 MORE OBSERVATIONS ARE NA COMPARED TO Q3 2021.

```{r}
#shows the first few rows, which should start with age 7
head(ppb_force122$civil_age_raw, n = 50L)
```

LOOKS OK AGAIN AFTER ADDING NEW DATA.

Create the perm var:

```{r}
ppb_force122$civil_age <- as.numeric(ppb_force122$civil_age_raw)
```

Now let's collapse the civilian age data down into age groups to match what PPB reports on their website:

```{r}
breaks <- c(7, 14, 24, 34, 49, 64, 99)
ppb_force122$civil_age_f <- cut(ppb_force122$civil_age_raw, breaks, 
  labels = c(
        "0-14", "15-24", "25-34", 
       "35-49", "50-64", "65+"))
ppb_force122 %>%
  group_by(civil_age_f) %>%
  summarise(n())   
```

**"civil_drug"**

```{r}
ppb_force122 %>%
  group_by(civil_drug_raw) %>%
  summarise(n())
```

```{r}
#Change the No and NA/blank to 0 and Unclear and Yes to 1...

ppb_force122$civil_drug_raw <- replace(ppb_force122$civil_drug_raw, ppb_force122$civil_drug_raw == "Unclear", 1)
ppb_force122$civil_drug_raw <- replace(ppb_force122$civil_drug_raw, ppb_force122$civil_drug_raw == "Yes", 1)
ppb_force122$civil_drug_raw <- replace(ppb_force122$civil_drug_raw, ppb_force122$civil_drug_raw == "No", 0)
ppb_force122$civil_drug_raw <- ppb_force122$civil_drug_raw %>% 
  replace_na(0)

ppb_force122 %>%
  group_by(civil_drug_raw) %>%
  summarise(n())
```

Now make the perm var:

```{r}
ppb_force122$civil_drug <- ppb_force122$civil_drug_raw
```

**"civil_etoh"**

```{r}
ppb_force122 %>%
  group_by(civil_etoh_raw) %>%
  summarise(n())
```

Need to change as above for civil_drug.

```{r}
#ppb_force122$civil_etoh_raw <- replace(ppb_force122$civil_etoh_raw, ppb_force122$civil_etoh_raw == "Unclear", 1)
ppb_force122$civil_etoh_raw <- replace(ppb_force122$civil_etoh_raw, ppb_force122$civil_etoh_raw == "Yes", 1)
ppb_force122$civil_etoh_raw <- replace(ppb_force122$civil_etoh_raw, ppb_force122$civil_etoh_raw == "No", 0)
ppb_force122$civil_etoh_raw <- ppb_force122$civil_etoh_raw %>% 
  replace_na(0)

ppb_force122 %>%
  group_by(civil_etoh_raw) %>%
  summarise(n())
```

Now make the perm var:

```{r}
ppb_force122$civil_etoh <- ppb_force122$civil_etoh_raw
```

**"civil_id"**

AS BEFORE, THERE ARE PROBS WITH SOME OF THESE ID'S FROM 2017. NOT CORRECTED HERE, 2017 WILL BE EXCLUDED FROM ANALYSIS LATER.

To make perm var:

```{r}
ppb_force122$civil_id <- as.numeric(ppb_force122$civil_id_raw)
```

**"civil_instance"**

According PPB metadata description on their website, *civil_instance* is an "Unique identifier combining randomly generated subject number and randomly generated record number for purposes of calculations." I do not as yet understand the purpose of this variable.

```{r}
head(ppb_force122$civil_instance_raw, n = 100L)
```

This is a peculiar variable. Need to ask PPB what it is. I note that the 7 cases missing for *civil_id* are also missing for this variable.

QUESITON FOR PPB: WHAT IS THE VARIABLE YOU CALL "SubjectInstance" AND HOW IS IT USED?\*

For now, I will make the var permanent:

```{r}
ppb_force122$civil_instance <- as.numeric(ppb_force122$civil_instance_raw)
```

**"civil_mental"**

Here is how PPB defines a mental health crisis (source: PPB Directive 1010.00, <https://www.portlandoregon.gov/police/article/751998> "Mental Health Crisis: An incident in which someone with an actual or perceived mental illness experiences intense feelings of personal distress (e.g., anxiety, depression, anger, fear, panic, hopelessness), a thought disorder (e.g., visual or auditory hallucinations, delusions, sensory impairment or cognitive impairment), obvious changes in functioning (e.g., neglect of personal hygiene) and/or catastrophic life events (e.g., disruptions in personal relationships, support systems or living arrangements; loss of autonomy or parental rights; victimization or natural disasters), which may, but not necessarily, result in an upward trajectory of intensity culminating in thoughts or acts that are dangerous to self and/or others."

PPB defines mental illness thusly (same source): "Mental Illness: Health conditions that are characterized by alterations in thinking, mood, or behavior (or some combination thereof) associated with distress and/or impaired functioning. Alterations in thinking, mood, or behavior contribute to a host of problems-patient distress, impaired functioning, or heightened risk of death, pain, disability, or loss of freedom."

For most interactions in the PPB force dataset, nothing about mental status is recorded (value = NA) but if an officer perceives mental illness, value = Yes. In some few cases, an officer explicitly recorded seeing no sign of mental crisis. In an additional few cases, the officer was uncertain. (These values of "uncertain" and "no" are said to have been recorded only in earlier years before the data "mask" (the force-reporting form) was changed.

Expert opinion is that mental problems are often missed by officers. Certainly, the rates at which mental illness is perceived by officers is much lower in these data than studies of mental illness prevalence have estimated. It would be impossible even for a psychiatrist during a brief, stressful encounter to diagnose a mental illness.

```{r}
ppb_force122 %>%
  group_by(civil_mental_raw) %>%
  summarise(n())
```

This perception of mental status variable needs to be re-coded so that both NA and No count as No and set equal to 0. I also propose to include the cases labeled "unclear" as Yes, as I did with *civil_etoh_raw*. This "unclear" category has too few cases to support much analysis on its own and is presumably irretrievably confounded with year of interaction.

By changing this var and others to 0,1 values we can more easily sum up data when multiple officers are involved, or multiple citizens are involved.

```{r}
ppb_force122$civil_mental_raw <- replace(ppb_force122$civil_mental_raw, ppb_force122$civil_mental_raw == "Unclear", 1)
ppb_force122$civil_mental_raw <- replace(ppb_force122$civil_mental_raw, ppb_force122$civil_mental_raw == "Yes", 1)
ppb_force122$civil_mental_raw <- replace(ppb_force122$civil_mental_raw, ppb_force122$civil_mental_raw == "No", 0)

#THIS IS THE CODE THAT WORKED FOR ETOH AND DRUG.
ppb_force122$civil_mental_raw <- ppb_force122$civil_mental_raw %>% 
   replace_na(0)
```

```{r}
ppb_force122 %>%
  group_by(civil_mental_raw) %>%
  summarise(n())
```

Now make a permanent newvar:

```{r}
ppb_force122$civil_mental <- ppb_force122$civil_mental_raw
```

**"civil_race"**

```{r}
ppb_force122 %>%
  group_by(civil_race_raw) %>%
  summarise(n())
```

```{r}
ppb_force122$civil_race_raw <- replace(ppb_force122$civil_race_raw, ppb_force122$civil_race_raw == "Unknown", NA)
```

```{r}

ppb_force122 %>%
  group_by(civil_race_raw) %>%
  summarise(n())
```

create the permanent variable:

```{r}
ppb_force122$civil_race <- ppb_force122$civil_race_raw
```

**"civil_sex"**

```{r}
ppb_force122 %>%
  group_by(civil_sex_raw) %>%
  summarise(n())
```

```{r}
ppb_force122$civil_sex_raw <- replace(ppb_force122$civil_sex_raw, ppb_force122$civil_sex_raw == "Unknown", NA)
```

```{r}
ppb_force122 %>%
  group_by(civil_sex_raw) %>%
  summarise(n())
```

Now create permanent variable:

```{r}
ppb_force122$civil_sex <- ppb_force122$civil_sex_raw
```

**"civil_transient"**

```{r}
ppb_force122 %>%
  group_by(civil_transient_raw) %>%
  summarise(n())
```

"Transient" is based on whether the civilian provides and address to the officer. Usually, this refusal does not signify houselessness. Hard to say what "Unknown" signifies. This value occurs in every year about equally. Will change "Unknown" and 0 to "Yes", indicating no address given... NOTE: THIS IS A CHANGE FROM THE ORIGINAL PROGRAM, WHICH CONVERTED "Unknown" to NA.

```{r}
ppb_force122$civil_transient_raw <- replace(ppb_force122$civil_transient_raw, ppb_force122$civil_transient_raw == "Unknown", "Yes")
ppb_force122$civil_transient_raw <- ppb_force122$civil_transient_raw %>% 
  replace_na("Yes")
ppb_force122$civil_transient_raw <- replace(ppb_force122$civil_transient_raw, ppb_force122$civil_transient_raw == 0, "Yes")
```

```{r}
ppb_force122 %>%
  group_by(civil_transient_raw) %>%
  summarise(n())
```

Success. Now make a permanent var:

```{r}
ppb_force122$civil_transient <- ppb_force122$civil_transient_raw
```

**"incid_force_lev"**

```{r}
ppb_force122 %>%
  group_by(incid_force_lev_raw) %>%
  summarise(n())
```

These are force level codes applied by officers and their supervisors to indicate the severity of force applied.

UPDATED INFO: In a zoom meeting with PPB inspector general's office, I got a detailed explanation of how these force levels are decided. Supervisors assign them based partly on what happened during the incident and based partly on whether the kind of force applied is a category that leadership wants to bump up for higher level review, e.g., vehicle pursuits. The force level determines how high up the chain an event goes for review.

PPB suggested that I try using their force level determinations rather than creating my own, as I did (in subsequent code) for my first pass through the data. But where then to draw the line? One PPB participant suggested between IV and all other. In a later written communication, PPB suggested looking at types of force one by one, rather than trying to group in to a 0/1 ranking of "severity." I responded by email that I would try this.

At this stage of the coding, all that's required is to clean up PPB's own categories...

```{r}
ppb_force122$incid_force_lev_raw <- replace(ppb_force122$incid_force_lev_raw, ppb_force122$incid_force_lev_raw == "Null", NA)
```

```{r}
ppb_force122 %>%
  group_by(incid_force_lev_raw) %>%
  summarise(n())
```

Now create a permanent force_lev var:

```{r}
ppb_force122$incid_force_lev <- ppb_force122$incid_force_lev_raw

ppb_force122 %>%
  group_by(incid_force_lev, incid_force_lev_raw) %>%
  summarise(n())
```

These Roman numbers cannot be manipulated arithmetically, however. The following code creates a newvar, *incid_force_calc*, that gives numerical values to PPB's force level assignments. I reverse the numerical order so that more severe gets a higher number:

```{r}
# the replace() function only works within a var, so must create the newvar first.
ppb_force122$incid_force_calc <- ppb_force122$incid_force_lev

ppb_force122$incid_force_calc <- replace(ppb_force122$incid_force_calc, ppb_force122$incid_force_calc == "IV", 1)
ppb_force122$incid_force_calc <- replace(ppb_force122$incid_force_calc, ppb_force122$incid_force_calc == "III", 2)
ppb_force122$incid_force_calc <- replace(ppb_force122$incid_force_calc, ppb_force122$incid_force_calc == "II", 3)

#I will put a conversion for force_lev=I in case we can add those observations later
ppb_force122$incid_force_calc <- replace(ppb_force122$incid_force_calc, ppb_force122$incid_force_calc == "I", 4)

ppb_force122 %>%
  group_by(incid_force_calc) %>%
  summarise(n())
```

**"force1"**

This is the first of 8 identical *force/n* vars, each of which records a single type of force used at a particular moment, in temporal sequence, i.e., first application of force recorded in *force1*, second in *force2*, etc. Once no additional force was used, the value for subsequent potential applications is NA.

There is one mysterious Value = Null in these variables.)

Wrangling Plan: Below, I will display the counts of each force var. Then, at the end, I will try to mutate these vars into newvars that will allow analyses of total counts of force, counts by level of force, and ultimately counts at the level of the encounter (multiple officers, one civilian) and of the officer (one officer, or summed to precinct, many civilians and encounters). Later, I will try to write code that will make these mutations simultaneously across all 8 *force/n* variables. Ditto for changing Null to NA.

```{r}
forcelist122 <- ppb_force122 %>%
  group_by(force1_raw) %>%
  summarise(n())



print.data.frame(forcelist122)
remove(forcelist122)
```

There is 1 value = Null, but no NAs. This obs deserves inspection as in theory no use of force report should lack a description of the first (and possibly only) kind of force that was used.

The 22 text string values for the force vars are not all self-explanatory...

Aerosol restraint.: UPDATE: NOT tear gas, pepper spray. oleoresin capsaicum, various strengths. disables and blinds.

Box-in VIS: Per Directive 1010.00 "Boxing In: A coordinated tactic of making contact between police vehicles and a subject's vehicle to stop or prevent the start of a pursuit." What is VIS?

CEW: Per Directive 1010.00: "Conducted Electrical Weapon (CEW): A weapon, including Tasers, designed primarily to discharge electrical charges into a subject that will cause involuntary muscle contractions and overrides the subject's voluntary motor responses."

CHWI: Tentatively, based on <https://static1.squarespace.com/static/5a319f76a9db0901e16c6433/t/5a72c5b8f9619ac3d252e2a8/1517471195108/Oct+2+Final+COCL+report+appendices.pdf> , Control Hold With Injury.

UPDATE: FD-animal aggressive means firearm discharge at an animal that is acting aggressively towards an officer

UPDATE: FD-animal suffer is firearm discharge to end an animal's suffering.

UPDATE; K9 means use of a police dog to control a citizen.

Hobble: from an Oregonlive webpage, "a nylon strap that ties a person's ankles together and links them to their wrists handcuffed behind their back. It's a maximum restraint used on combative people"

Impact Muni: UPDATE: rubber bullets, bean bags, wooden dowels, foam projectiles, these days launched from special firearms.

Less Lethal Force: Per Directive 1010.00, "A force application that is not intended or expected to cause death or serious injury and that is commonly understood to have less potential for causing death or serious injury than conventional, more lethal police tactics. Nonetheless, use of less-lethal force can result in death or serious injury."

PFA: UPDATE: pointing firearm

PIT - VIS: Per Wikipedia, "The PIT maneuver (pursuit intervention technique) or TVI (tactical vehicle intervention) is a pursuit tactic by which a pursuing car can force a fleeing car to turn sideways abruptly, causing the driver to lose control and stop". Not sure what VIS means--vehicle in sight???

Ram - VIS: striking a moving vehicle with a police vehicle to stop or force off the road.

UPDATE: Takedown. Three values appear in the data: Takedown, Takedown (II and III), and Takedown (IV). Presumably, the Roman numerals refer to the level of force of the Takedown. (IV is lowest degree of force.) Takedown without an indication of force was used in 2017 only.  Later, 2017 will be excluded from analyses.

Let's look at these uses of force by year.

```{r}
CrossTable(ppb_force122$force1_raw, ppb_force122$incid_year_raw)
```

Just a quick look, no denominator, not aggregated to incidents (so this is just looking at the first force instance, and just one officer at a time), not controlling for mental health, not cleaning the year data. Just looking at 2018-2021, most force types holding steady, pepper spray increasing, some decreasing. This confirms PPB suggestion that I separate takedowns by force level, since I am using post 2017 data, which uses force levels consistently in takedowns.

**"force2"**

```{r}
ppb_force122 %>%
  group_by(force2_raw) %>%
  summarise(n())
```

One "Null" here, as well, and many NAs. NAs make sense because in most interactions, only one form of force was necessary or applied.

**"force3"**

```{r}
ppb_force122 %>%
  group_by(force3_raw) %>%
  summarise(n())
```

No more Null value.

**"force4"**

```{r}
ppb_force122 %>%
  group_by(force4_raw) %>%
  summarise(n())
```

**"force5"**

```{r}
ppb_force122 %>%
  group_by(force5_raw) %>%
  summarise(n())
```

**"force6"**

```{r}
ppb_force122 %>%
  group_by(force6_raw) %>%
  summarise(n())
```

**"force7"**

```{r}
ppb_force122 %>%
  group_by(force7_raw) %>%
  summarise(n())
```

**"force8"**

```{r}
ppb_force122 %>%
  group_by(force8_raw) %>%
  summarise(n())
```

First, let's get the Null values into the NA category to create clean permanent *force/n* variables.

```{r}
#going against my usual pattern here by creating the perm var BEFORE transforming the raw var.
ppb_force122$force1 <- ppb_force122$force1_raw
ppb_force122$force2 <- ppb_force122$force2_raw
ppb_force122$force3 <- ppb_force122$force3_raw
ppb_force122$force4 <- ppb_force122$force4_raw
ppb_force122$force5 <- ppb_force122$force5_raw
ppb_force122$force6 <- ppb_force122$force6_raw
ppb_force122$force7 <- ppb_force122$force7_raw
ppb_force122$force8 <- ppb_force122$force8_raw

ppb_force122$force1 <- replace(ppb_force122$force1, ppb_force122$force1 == "Null", NA)
ppb_force122$force2 <- replace(ppb_force122$force2, ppb_force122$force2 == "Null", NA)
ppb_force122$force3 <- replace(ppb_force122$force3, ppb_force122$force3 == "Null", NA)
ppb_force122$force4 <- replace(ppb_force122$force4, ppb_force122$force4 == "Null", NA)
ppb_force122$force5 <- replace(ppb_force122$force5, ppb_force122$force5 == "Null", NA)
ppb_force122$force6 <- replace(ppb_force122$force6, ppb_force122$force6 == "Null", NA)
ppb_force122$force7 <- replace(ppb_force122$force7, ppb_force122$force7 == "Null", NA)
ppb_force122$force8 <- replace(ppb_force122$force8, ppb_force122$force8 == "Null", NA)


```

```{r}
ppb_force122 %>%
  group_by(force1, force1_raw)  %>%
  summarize(n())
```

This worked, as shown by the *force1* example.

Second, let's create vars that indicate whether each potential force "moment" is occupied or blank. First I will create new force vars to record any use of force, rather than what kind of force was used.

```{r}

ppb_force122$force1_any <- ppb_force122$force1
ppb_force122$force2_any <- ppb_force122$force2
ppb_force122$force3_any <- ppb_force122$force3
ppb_force122$force4_any <- ppb_force122$force4
ppb_force122$force5_any <- ppb_force122$force5
ppb_force122$force6_any <- ppb_force122$force6
ppb_force122$force7_any <- ppb_force122$force7
ppb_force122$force8_any <- ppb_force122$force8
```

For *force1*, because by definition in a use of force dataset, the there must be at least one use of force, even if its nature is not recorded, I will change the former "Null" value to 1. I will only do this for *force1*.

```{r}
ppb_force122$force1_any <- ifelse(is.na(ppb_force122$force1_any), ppb_force122$force1_any == "zero", ppb_force122$force1_any == "one")

ppb_force122$force1_any <- replace(ppb_force122$force1_any, ppb_force122$force1_any == FALSE, 1)

ppb_force122$force1_any <- ppb_force122$force1_any %>% 
  replace_na(1)
```

```{r}
ppb_force122 %>%
  group_by(force1_any) %>%
  summarise(n())
```

Excellent. Now repeat this for the other *forceN* vars, except for these NA will be changed to zero:

```{r}
ppb_force122$force2_any <- ifelse(is.na(ppb_force122$force2_any), ppb_force122$force2_any == "zero", ppb_force122$force2_any == "one")
ppb_force122$force2_any <- replace(ppb_force122$force2_any, ppb_force122$force2_any == FALSE, 1)
ppb_force122$force2_any <- ppb_force122$force2_any %>% 
  replace_na(0)

ppb_force122$force3_any <- ifelse(is.na(ppb_force122$force3_any), ppb_force122$force3_any == "zero", ppb_force122$force3_any == "one")
ppb_force122$force3_any <- replace(ppb_force122$force3_any, ppb_force122$force3_any == FALSE, 1)
ppb_force122$force3_any <- ppb_force122$force3_any %>% 
  replace_na(0)

ppb_force122$force4_any <- ifelse(is.na(ppb_force122$force4_any), ppb_force122$force4_any == "zero", ppb_force122$force4_any == "one")
ppb_force122$force4_any <- replace(ppb_force122$force4_any, ppb_force122$force4_any == FALSE, 1)
ppb_force122$force4_any <- ppb_force122$force4_any %>% 
  replace_na(0)

ppb_force122$force5_any <- ifelse(is.na(ppb_force122$force5_any), ppb_force122$force5_any == "zero", ppb_force122$force5_any == "one")
ppb_force122$force5_any <- replace(ppb_force122$force5_any, ppb_force122$force5_any == FALSE, 1)
ppb_force122$force5_any <- ppb_force122$force5_any %>% 
  replace_na(0)

ppb_force122$force6_any <- ifelse(is.na(ppb_force122$force6_any), ppb_force122$force6_any == "zero", ppb_force122$force6_any == "one")
ppb_force122$force6_any <- replace(ppb_force122$force6_any, ppb_force122$force6_any == FALSE, 1)
ppb_force122$force6_any <- ppb_force122$force6_any %>% 
  replace_na(0)

ppb_force122$force7_any <- ifelse(is.na(ppb_force122$force7_any), ppb_force122$force7_any == "zero", ppb_force122$force7_any == "one")
ppb_force122$force7_any <- replace(ppb_force122$force7_any, ppb_force122$force7_any == FALSE, 1)
ppb_force122$force7_any <- ppb_force122$force7_any %>% 
  replace_na(0)

ppb_force122$force8_any <- ifelse(is.na(ppb_force122$force8_any), ppb_force122$force8_any == "zero", ppb_force122$force8_any == "one")
ppb_force122$force8_any <- replace(ppb_force122$force8_any, ppb_force122$force8_any == FALSE, 1)
ppb_force122$force8_any <- ppb_force122$force8_any %>% 
  replace_na(0)
```

No error messages. Let's make sure this worked:

```{r}
ppb_force122 %>%
  group_by(force2_any, force3_any, force4_any, force5_any, force6_any, force7_any, force8_any) %>%
  summarise(n())
```

Excellent.

Now let's create a var that adds up the number of force applications per officer-civilian interaction. Should match the table above...

```{r}
ppb_force122$force_officer_sum <- ppb_force122$force1_any + ppb_force122$force2_any  + ppb_force122$force3_any  + ppb_force122$force4_any  + ppb_force122$force5_any  + ppb_force122$force6_any  + ppb_force122$force7_any  + ppb_force122$force8_any

ppb_force122 %>%
   group_by(force_officer_sum) %>%
   summarise(n())
```

PPB official definition of force per Directive 1010.00: "Force: Physical coercion used to effect, influence or persuade an individual to comply with an officer, to include the intentional pointing of a firearm at an individual. Control holds and handcuffing without resistance do not constitute force." Force / coercion is implicit in any interaction with a police officer. By the PPB definition, force seems to mean a physical action that carries a risk of injury.


**"incid_day"**

```{r}
ppb_force122 %>%
  group_by(ppb_force122$incid_day_raw) %>%
  summarise(n())
```
```{r}
tabyl(ppb_force122, incid_day_raw, incid_year_raw)
```
So, the screwy day names only apply to 2017, which will be omitted in later analyes.  Still, I will continue as before and rename all consistently:


```{r}
ppb_force122$incid_day_raw <- replace(ppb_force122$incid_day_raw, ppb_force122$incid_day_raw == "FRI", "Friday")
ppb_force122$incid_day_raw <- replace(ppb_force122$incid_day_raw, ppb_force122$incid_day_raw == "MON", "Monday")
ppb_force122$incid_day_raw <- replace(ppb_force122$incid_day_raw, ppb_force122$incid_day_raw == "TUE", "Tuesday")
ppb_force122$incid_day_raw <- replace(ppb_force122$incid_day_raw, ppb_force122$incid_day_raw == "WED", "Wednesday")
ppb_force122$incid_day_raw <- replace(ppb_force122$incid_day_raw, ppb_force122$incid_day_raw == "THU", "Thursday")
ppb_force122$incid_day_raw <- replace(ppb_force122$incid_day_raw, ppb_force122$incid_day_raw == "SAT", "Saturday")
ppb_force122$incid_day_raw <- replace(ppb_force122$incid_day_raw, ppb_force122$incid_day_raw == "SUN", "Sunday")

ppb_force122$incid_day <- ppb_force122$incid_day_raw

ppb_force122 %>%
  group_by(ppb_force122$incid_day) %>%
  summarise(n())


```

**"incid_disp"**

```{r}
ppb_force122 %>%
  group_by(incid_disp_raw) %>%
  summarise(n())
```
confirms PPB advice that force is only used when officers intend to arrest or hospitalize subject.

Next, convert to perm var:

```{r}
ppb_force122$incid_disp <- ppb_force122$incid_disp_raw
```

Let's see how disposition correlates with mental status:

```{r}
CrossTable(ppb_force122$incid_disp_raw, ppb_force122$civil_mental, chisq = TRUE, simulate.p.value = TRUE)
```

Release to medical is the disposition of by far the great proportion of "mental" cases. Does this vary by year?

```{r}
tabyl(ppb_force122, incid_disp, incid_year_raw, civil_mental)

```
```{r}
tabyl(ppb_force122, incid_disp, incid_year_raw, civil_mental)  %>%
  adorn_percentages("col") %>%
  adorn_pct_formatting(digits = 0)
```
Misdemeanor arrests going down.  DOES THIS INDICATE INCREASED LIKELIHOOD OF RESISTANCE?  Detox disappeared, release to medical increasing for mental crisis cases.

```{r}
CrossTable(ppb_force122$civil_mental, ppb_force122$civil_transient, chisq = TRUE, simulate.p.value = TRUE)
```

Civilians not seen as in mental crisis are more likely to refuse to provide an address.

**"incid_id"**

COMMENT FROM Q3 2021: Randomly assigned incident number. Numerical variable. Just scanning the spreadsheet, I did not see a case in which 2 civilians shared the same incident number, so this looks like a true tag for "incidence," I found no case with a missing incident number. UPDATE Q1 2022: PPB agrees.  

Create permanent variable:

```{r}
ppb_force122$incid_id <- ppb_force122$incid_id_raw
```

**"incid_month"**

```{r}
ppb_force122 %>%
  group_by(incid_month_raw) %>%
  summarise(n())
```

Looks like no variant spellings and no case with a missing value for Month. I will make the permanent var directly form the raw:

```{r}
ppb_force122$incid_month <- ppb_force122$incid_month_raw
```


**"incid_sixhour"**

```{r}
ppb_force122 %>%
  group_by(incid_sixhour_raw) %>%
  summarise(n())
```

About 15% missing data here. No way to impute. Probably best to set the "-" to NA.

```{r}
ppb_force122$incid_sixhour_raw <- replace(ppb_force122$incid_sixhour_raw, ppb_force122$incid_sixhour_raw == "-", NA)
```

```{r}
ppb_force122 %>%
  group_by(incid_sixhour_raw) %>%
  summarise(n())
```

Success. Now make permanent:

```{r}
ppb_force122$incid_sixhour <- ppb_force122$incid_sixhour_raw
```

```{r}
ppb_force122 %>%
  group_by(incid_sixhour) %>%
  summarise(n())
```

OK.

**"incid_year"**

```{r}
ppb_force122 %>%
  group_by(incid_year_raw) %>%
  summarise(n())
```

UPDATE Q1 2022: one screwy data entry error.  this is new since q3 2021.  Let's see what month it is and correct it manually.

```{r}
tabyl(ppb_force122, incid_year_raw, incid_month)
```
So the screwy value is q1 2022.  Let's correct it:

```{r}
typeof(ppb_force122$incid_year_raw)
```


```{r}
ppb_force122$incid_year_raw <- replace(ppb_force122$incid_year_raw, ppb_force122$incid_year_raw == ".; ;", "2022")
```

```{r}
tabyl(ppb_force122, incid_year_raw, incid_month)
```
That did it.  Now make permanent...

```{r}
ppb_force122$incid_year <- ppb_force122$incid_year_raw
```

**"officer_id"**

Numeric data. Not the officer's real ID. Officer IDs are associated with more than one incidents, some with a large number of incidents. I found just one case with a missing officer ID number. Might be a case with some dirty data--officer's tenure was entered as 118 years. Well past retirement age! This case was from Dec 2017. Other data for that case seem OK.

Create permanent var:

```{r}
ppb_force122$officer_id <- ppb_force122$officer_id_raw
```

**"officer_precinct"**

```{r}
ppb_force122 %>%
  group_by(officer_precinct_raw) %>%
  summarise(n())
```

52 cases with missing precinct data. Leave these as NA and, in a supplemental variable create an expanded "other" category that matches how Rosenbaum and PPB report these data.

```{r}
ppb_force122$officer_precinct <- ppb_force122$officer_precinct_raw
ppb_force122$officer_precinct_collapsed <- ppb_force122$officer_precinct
```

```{r}
ppb_force122$officer_precinct_collapsed <- replace(ppb_force122$officer_precinct_collapsed, ppb_force122$officer_precinct_collapsed == "Other (please specify)", "Other")

ppb_force122$officer_precinct_collapsed <- replace(ppb_force122$officer_precinct_collapsed, ppb_force122$officer_precinct_collapsed == "Detectives", "Other")

ppb_force122$officer_precinct_collapsed <- replace(ppb_force122$officer_precinct_collapsed, ppb_force122$officer_precinct_collapsed == "DVD", "Other")

ppb_force122$officer_precinct_collapsed <- replace(ppb_force122$officer_precinct_collapsed, ppb_force122$officer_precinct_collapsed == "Family Services", "Other")

ppb_force122$officer_precinct_collapsed <- replace(ppb_force122$officer_precinct_collapsed, ppb_force122$officer_precinct_collapsed == "K9", "Other")

ppb_force122$officer_precinct_collapsed <- replace(ppb_force122$officer_precinct_collapsed, ppb_force122$officer_precinct_collapsed == "Strategic Services: CIU", "Other")

ppb_force122$officer_precinct_collapsed <- replace(ppb_force122$officer_precinct_collapsed, ppb_force122$officer_precinct_collapsed == "Specialty", "Other")

ppb_force122$officer_precinct_collapsed <- replace(ppb_force122$officer_precinct_collapsed, ppb_force122$officer_precinct_collapsed == "Training", "Other")

ppb_force122$officer_precinct_collapsed <- replace(ppb_force122$officer_precinct_collapsed, ppb_force122$officer_precinct_collapsed == "Transit (PPB Only)", "Transit")

ppb_force122$officer_precinct_collapsed <- replace(ppb_force122$officer_precinct_collapsed, ppb_force122$officer_precinct_collapsed == "Youth Services", "Other")

ppb_force122$officer_precinct_collapsed <- replace(ppb_force122$officer_precinct_collapsed, ppb_force122$officer_precinct_collapsed == "Personnel", "Other")
```

```{r}
ppb_force122 %>%
   group_by(officer_precinct_raw, officer_precinct_collapsed, officer_precinct) %>%
   summarise(n())
```

**"officer_tenure"**

```{r}
typeof(ppb_force122$officer_tenure_raw)
```


```{r}
#nextline sorts by tenure.  if want descending, type - before varname.  can list multiple sorting vars.
ppb_force122 <- ppb_force122[order (ppb_force122$officer_tenure_raw),]

#shows the last 200 rows
tail(ppb_force122$officer_tenure_raw, n = 200L)
```

Longest serving officer has 33 years in the Bureau. 4 NAs. Three with tenure over 100 years, can't be correct.

```{r}
head(ppb_force122$officer_tenure_raw, n = 200L)
```

95 cases with tenure approx = 0 (could be negatively or positively near zero). 2 cases with substantially negative numbers. 10 cases with a positive decimal extremely close to zero, far too small to equate to a month of tenure, or even a day. Some officers were from the "training" precinct, maybe this explains some of the weird numbers. Should probably wipe out the extreme values and set them to NA.

First, let's get the crazy numbers changed to NA.

```{r}
ppb_force122$officer_tenure_raw <- replace(ppb_force122$officer_tenure_raw, ppb_force122$officer_tenure_raw <= -0.01, NA)
ppb_force122$officer_tenure_raw <- replace(ppb_force122$officer_tenure_raw, ppb_force122$officer_tenure_raw >= 40, NA)

```

Based on the inspection described below, I will make this no-outliers dataset the permanent (non-raw) *measured* tenure variable:

```{r}
ppb_force122$officer_tenure <- ppb_force122$officer_tenure_raw
```

Now, let's see how training relates to years of tenure:

```{r}
test3 <- ppb_force122 %>% 
  filter(!is.na(officer_tenure_raw)) %>% 
  group_by(officer_precinct_raw) %>% 
  summarise(
    n                    = n(),
    mean                 = mean(officer_tenure_raw),
    `standard deviation` = sd(officer_tenure_raw),
    min                  = min(officer_tenure_raw),
    max                  = max(officer_tenure_raw)
  ) %>% 
  print()
```

There are zero-tenure values for precinct == training but also in the large geographic precincts. Let's make a factor (categorical) var that includes possible floating-point negatives to see how many zeroes are in each precinct. To reduce clutter, I also will create a temporary collapsed2 precinct var that lets training appear as its own category:

```{r}
test4 <- ppb_force122
test4$officer_precinct_collapsed2 <- test4$officer_precinct

test4$officer_precinct_collapsed2 <- replace(test4$officer_precinct_collapsed2, test4$officer_precinct_collapsed2 == "Other (please specify)", "Other")

test4$officer_precinct_collapsed2 <- replace(test4$officer_precinct_collapsed2, test4$officer_precinct_collapsed2 == "Detectives", "Other")

test4$officer_precinct_collapsed2 <- replace(test4$officer_precinct_collapsed2, test4$officer_precinct_collapsed2 == "DVD", "Other")

test4$officer_precinct_collapsed2 <- replace(test4$officer_precinct_collapsed2, test4$officer_precinct_collapsed2 == "Family Services", "Other")

test4$officer_precinct_collapsed2 <- replace(test4$officer_precinct_collapsed2, test4$officer_precinct_collapsed2 == "K9", "Other")

test4$officer_precinct_collapsed2 <- replace(test4$officer_precinct_collapsed2, test4$officer_precinct_collapsed2 == "Strategic Services: CIU", "Other")

test4$officer_precinct_collapsed2 <- replace(test4$officer_precinct_collapsed2, test4$officer_precinct_collapsed2 == "Specialty", "Other")

#test4$officer_precinct_collapsed2 <- replace(test4$officer_precinct_collapsed2, #test4$officer_precinct_collapsed2 == "Training", "Other")

test4$officer_precinct_collapsed2 <- replace(test4$officer_precinct_collapsed2, test4$officer_precinct_collapsed2 == "Transit (PPB Only)", "Transit")

test4$officer_precinct_collapsed2 <- replace(test4$officer_precinct_collapsed2, test4$officer_precinct_collapsed2 == "Youth Services", "Other")

test4$officer_precinct_collapsed2 <- replace(test4$officer_precinct_collapsed2, test4$officer_precinct_collapsed2 == "Personnel", "Other")
```

```{r}
breaks4 <- c(-0.05, 0, 0.05, 50)
test4$officer_tenure_test4 <- cut(test4$officer_tenure_raw, breaks4, 
  labels = c("-0.05-0", "0-0.05", "0.05+" ))

```

```{r}
gmodels::CrossTable(test4$officer_precinct_collapsed2, test4$officer_tenure_test4)
```

OK. Training has the highest *proportion* of near-zero negatives, but the large, geographic precincts higher counts.\
Difficult to know what these near-zero values signify. Ask PPB. Looks like a problem with the method PPB uses to calculate tenure. Options are to code them as exactly zero or change them to NA. Given that the near-zeroes are very common in the Training "precinct," it seems that they might mean something real. Therefore, I will leave them unmodified in the *officer_tenure* permanent variable and force them to ==0 in the factor variable that I create from the measured data.

*QUESTION FOR PPB: WHAT EXPLAINS THESE NEAR-ZERO TENURE VALUES?*

Are the zeroes associated with year, ie, is this possibly a coding error from the early days of report transcription?

```{r}
ppb_force122_summary <- ppb_force122 %>% 
  filter(!is.na(officer_tenure_raw)) %>% 
  group_by(incid_year) %>% 
  summarise(
    n                    = n(),
    mean                 = mean(officer_tenure_raw),
    `standard deviation` = sd(officer_tenure_raw),
    min                  = min(officer_tenure_raw),
    max                  = max(officer_tenure_raw)
  ) %>% 
  print()
```

Just using mean tenure, tenure is decreasing with year. Let's create a factor variable to group tenure into groups. After some fiddling to get groups of approximately equal size:

```{r}
breaks <- c(-0.01, 2, 5, 10, 15, 20, 50)
ppb_force122$officer_tenure_f <- cut(ppb_force122$officer_tenure_raw, breaks, 
  labels = c(
        "[0-2]", "(2-5]", "(5-10]", "(10-15]", "(15-20]", 
       "(20+"))
ppb_force122 %>%
  group_by(officer_tenure_f) %>%
  summarise(n())
```

Now, is tenure, esp. tenure below 5 yrs, correlated with year?

```{r}
gmodels::CrossTable(ppb_force122$incid_year, ppb_force122$officer_tenure_f)
```

There does seem to be a non-linear correlation with Year. Short-tenure offices were involved in a higher percentage of forceful interactions starting in 2018, peaking in 2019, and receding to 2018 levels in 2021. This does not seem like a result of data entry abnormalities but rather some real process.


**"recordcount_1"** **"recordcount_2"**

According to PPB Metadata description, Record Count is 'The number of times a record (or FDCR) has been submitted. In the overwhelming majority of cases there is only a single record submitted, however if an officer uses more instances of force than can be tracked on a single FDCR (up to 8) a second will be submitted under the same Record ID. The 'Record Count' will display how many duplicate instances there are for an officer in an single event. For example, if an officer uses force on the same subject in the same instance 9 or more times, there will be a Record Count of "2".

This is not how the data actually look.

```{r}
ppb_force122 %>%
  group_by(recordcount_1_raw, recordcount_2_raw) %>%
  summarise(n())
```
**UPDATE: THIS IS PECULIAR.  In data downloaded previously there was 1 instance of recordcount = 2 and one instance of recordcount = 10.  Now, when downloaded after Q1 2022, there are 3 instances of recordcount = 4 and the previous recordcount = 2 has disappeared.**  That incid_id was 706548204	.  This incident is still in the dataset, it is the one that now has recordcount_2_raw = 10. It is remedied below. 

Let's look at the 4's.  Per below, there are 2 FDRCs, same incident, different officers.  But there should be 8, if each submitted 4 FDRCs.  This must be a data entry error or else the other FDRCs were not submitted.  

```{r}
data_test2 <- ppb_force122[ppb_force122$recordcount_1_raw == 4, ]
data_test2
```
```{r}
data_test3 <- ppb_force122[ppb_force122$incid_id == 146558939, ]
data_test3
```

OK, This occurred Q4 2021, so new data.  4 officers present, 2 of them used more than 8 applications of force so each tag indicates that there IS a second FDCR, not that the tagged FDCR is THE second report. The 4 appears in each officer's 8-application FDCR.  Should have been coded as 2s.  Possibly the data entry person was thinking there were 4 total reports among the duplicates? So let's change the 4s to 2s.

```{r}
ppb_force122$recordcount_1_raw  <- replace (ppb_force122$recordcount_1_raw, ppb_force122$recordcount_1_raw == 4, 2)
ppb_force122$recordcount_2_raw  <- replace (ppb_force122$recordcount_2_raw, ppb_force122$recordcount_2_raw == 4, 2)

ppb_force122 %>%
  group_by(recordcount_1_raw, recordcount_2_raw) %>%
  summarise(n())
```


Let's take a look at the observation where reccount1raw = 10:

```{r}
data_test <- ppb_force122[ppb_force122$recordcount_1_raw == 10, ]
data_test
```

Well, this observation shows both resistance and force through 8 repetitions for a white male with a knife and an officer with 10 years in the force from the training "precinct." The force is repetitively "Less Lethal". Let's check whether there are many rows for this particular incident:

```{r}
remove(data_test)
data_test <- ppb_force122[ppb_force122$incid_id_raw == 706548204, ]
data_test
```

There are 10 rows for the same civilian involving 9 different officers and a lot of pepper spray. One officer submitted 2 reports, so the record count for one of that officer's reports should be 2, but instead the second record count is 10. Data input error, wrong definition of number of records. This should be changed to 2:

```{r}
ppb_force122$recordcount_2_raw  <- replace (ppb_force122$recordcount_2_raw, ppb_force122$recordcount_2_raw == 10, 2)
```

```{r}
ppb_force122 %>%
  group_by(ppb_force122$recordcount_1_raw, ppb_force122$recordcount_2_raw) %>%
  summarise(n())
```
Finally, let's create the permanent variables:

```{r}
ppb_force122$recordcount_1 <- ppb_force122$recordcount_1_raw

ppb_force122$recordcount_2 <- ppb_force122$recordcount_2_raw

ppb_force122 %>%
  group_by(recordcount_1, recordcount_2) %>%
  summarise(n())
```
OK.  Clean as of Q1 2022.

*civil_instance*

*civil_instance_raw* is sometimes missing:

```{r}
remove(data_temp2)
data_temp2 <- ppb_force122[order(ppb_force122$civil_instance_raw), na.last = TRUE]

tail(data_temp2, n = 20)
```

UPDATE: There ARE STILL 7 records with missing values for *civil_instance_raw*. All 7 are from 2017, the first data collection period, when data collection and transcription problems are more frequent. All 7 lack *civil_age* and *civil_id*. But the rest of the data are intact. I would leave as is. If necessary, could assign id numbers to these cases later.

```{r}
remove(data_temp2)

ppb_force122$civil_instance <- ppb_force122$civil_instance_raw
```


**RESISTANCE VARIABLES**

Here are some definitions from the PPB Metadata webpage:

No weapon (unarmed): Subject was unarmed during force event

Firearm: Subject was armed with a firearm during the force event

Firearm - Replica: Subject was armed with a replica firearm during the force event

Firearm - Implied: Subject implied being armed with a firearm during the force event

Knife / Edged Weapon / Stabbing Instrument: Subject was armed with a knife, edged weapon or stabbing instrument during the force event

Blunt Object: Subject was armed with a blunt object during the force event

Needle / Spit / Bodily Fluids: Subject was armed with and/or used a needle, spit or other bodily fluids as a weapon during the force event

Weapon Present or reported but not used or threatened use: A weapon was present or reported to be present during the force event, but the subject did not utilize or threaten officers with mentioned reported weapon

Other Weapon: Subject was armed with another type of weapon not already listed during the force event

*resist1* through *resist8* record the kinds of forceful or passive resistance used by one civilian, ordered according to the temporal sequence in which each form of resistance occurred or continued. Presumably, civilian resistance persists or evolves over time in response to officers' use of force, although hypothetically a civilian's threats also could escalate while an officer maintained passive. The variables *resist2* thru *resist8* could logically be blank if resistance or officer-force did not continue or evolve.


```{r}
ppb_force122 %>%
  group_by(resist1_raw) %>%
  summarise(n())
```

There appear to be 6 possible answers, plus NA. Let's see if there is any correlation between the ambiguous answers and year of data collection:

```{r}
ppb_force122 %>%
  group_by(resist1_raw, incid_year) %>%
  summarise(n())
```

No obvious large problems. "Unclear" appears only in 2017, "NA" appears in subsequent years. There are 6 cases with missing data (coded "NA"), 8 cases coded "Null," and 2 cases coded as "unclear." Does "Null" mean no resistance, or no data?  UPDATE**I will no longer assume that Null means no resistance and will code it as NA, which as where the vast majority of no-resistance values are in resist2 and later. I  also Will sweep "Unclear" into NA.**

Why no instances of deadly resistance in the dataset after 2018?

```{r}
ppb_force122$resist1_raw <- replace(ppb_force122$resist1_raw, ppb_force122$resist1_raw == "Unclear", NA)

ppb_force122$resist1_raw <- replace(ppb_force122$resist1_raw, ppb_force122$resist1_raw == "Null", NA)

ppb_force122$resist1_raw <- replace(ppb_force122$resist1_raw, ppb_force122$resist1_raw == "None", NA)
```

```{r}
ppb_force122 %>%
  group_by(resist1_raw) %>%
  summarise(n())
```
```{r}
ppb_force122$resist1_raw <- ppb_force122$resist1_raw %>%
  replace_na("None")

ppb_force122 %>%
  group_by(resist1_raw) %>%
  summarise(n())


```




Confirmed. I will do the same to the other 7 *resist* variables:


**"resist2"**

```{r}
ppb_force122 %>%
  group_by(resist2_raw) %>%
  summarise(n())
```

```{r}
ppb_force122$resist2_raw <- replace(ppb_force122$resist2_raw, ppb_force122$resist2_raw == "Unclear", NA)

ppb_force122$resist2_raw <- replace(ppb_force122$resist2_raw, ppb_force122$resist2_raw == "Null", NA)

ppb_force122$resist2_raw <- replace(ppb_force122$resist2_raw, ppb_force122$resist2_raw == "None", NA)


```
```{r}
ppb_force122$resist2_raw <- ppb_force122$resist2_raw %>%
  replace_na("None")

ppb_force122 %>%
  group_by(resist2_raw) %>%
  summarise(n())


```


**"resist3"**


```{r}
ppb_force122$resist3_raw <- replace(ppb_force122$resist3_raw, ppb_force122$resist3_raw == "Unclear", NA)

ppb_force122$resist3_raw <- replace(ppb_force122$resist3_raw, ppb_force122$resist3_raw == "Null", NA)

ppb_force122$resist3_raw <- replace(ppb_force122$resist3_raw, ppb_force122$resist3_raw == "None", NA)


ppb_force122$resist3_raw <- ppb_force122$resist3_raw %>%
  replace_na("None")

ppb_force122 %>%
  group_by(resist3_raw) %>%
  summarise(n())


```


**"resist4"**

```{r}
ppb_force122$resist4_raw <- replace(ppb_force122$resist4_raw, ppb_force122$resist4_raw == "Unclear", NA)

ppb_force122$resist4_raw <- replace(ppb_force122$resist4_raw, ppb_force122$resist4_raw == "Null", NA)

ppb_force122$resist4_raw <- replace(ppb_force122$resist4_raw, ppb_force122$resist4_raw == "None", NA)

ppb_force122$resist4_raw <- ppb_force122$resist4_raw %>%
  replace_na("None")

ppb_force122 %>%
  group_by(resist4_raw) %>%
  summarise(n())


```


**"resist5"**



```{r}
ppb_force122$resist5_raw <- replace(ppb_force122$resist5_raw, ppb_force122$resist5_raw == "Unclear", NA)

ppb_force122$resist5_raw <- replace(ppb_force122$resist5_raw, ppb_force122$resist5_raw == "Null", NA)

ppb_force122$resist5_raw <- replace(ppb_force122$resist5_raw, ppb_force122$resist5_raw == "None", NA)

ppb_force122$resist5_raw <- ppb_force122$resist5_raw %>%
  replace_na("None")

ppb_force122 %>%
  group_by(resist5_raw) %>%
  summarise(n())


```


**"resist6"**


```{r}
ppb_force122$resist6_raw <- replace(ppb_force122$resist6_raw, ppb_force122$resist6_raw == "Unclear", NA)

ppb_force122$resist6_raw <- replace(ppb_force122$resist6_raw, ppb_force122$resist6_raw == "Null", NA)

ppb_force122$resist6_raw <- replace(ppb_force122$resist6_raw, ppb_force122$resist6_raw == "None", NA)

ppb_force122$resist6_raw <- ppb_force122$resist6_raw %>%
  replace_na("None")

ppb_force122 %>%
  group_by(resist6_raw) %>%
  summarise(n())


```


**"resist7"**


```{r}
ppb_force122$resist7_raw <- replace(ppb_force122$resist7_raw, ppb_force122$resist7_raw == "Unclear", NA)

ppb_force122$resist7_raw <- replace(ppb_force122$resist7_raw, ppb_force122$resist7_raw == "Null", NA)

ppb_force122$resist7_raw <- replace(ppb_force122$resist7_raw, ppb_force122$resist7_raw == "None", NA)

ppb_force122$resist7_raw <- ppb_force122$resist7_raw %>%
  replace_na("None")

ppb_force122 %>%
  group_by(resist7_raw) %>%
  summarise(n())


```


**"resist8"**


```{r}
ppb_force122$resist8_raw <- replace(ppb_force122$resist8_raw, ppb_force122$resist8_raw == "Unclear", NA)

ppb_force122$resist8_raw <- replace(ppb_force122$resist8_raw, ppb_force122$resist8_raw == "Null", NA)

ppb_force122$resist8_raw <- replace(ppb_force122$resist8_raw, ppb_force122$resist8_raw == "None", NA)

ppb_force122$resist8_raw <- ppb_force122$resist8_raw %>%
  replace_na("None")

ppb_force122 %>%
  group_by(resist8_raw) %>%
  summarise(n())


```
UPDATE: Now create the permanent variables:

```{r}

ppb_force122$resist1 <- ppb_force122$resist1_raw
ppb_force122$resist8 <- ppb_force122$resist8_raw
ppb_force122$resist7 <- ppb_force122$resist7_raw
ppb_force122$resist6 <- ppb_force122$resist6_raw
ppb_force122$resist5 <- ppb_force122$resist5_raw
ppb_force122$resist4 <- ppb_force122$resist4_raw
ppb_force122$resist3 <- ppb_force122$resist3_raw
ppb_force122$resist2 <- ppb_force122$resist2_raw



```

UPDATE:  **CREATE NUMERICAL RESISTANCE MEASURES**

To calculate whether threat levels have been going up (or down) it would be helpful to have an arithmetic index of resistance.  Because high levels of resistance, i.e., deadly resistance, are presumably much more dangerous than lower levels, I will construct two arithmetic scales.

SCALE 1:  none = 0. passive = 1, active = 1, agressive = 2 and deadly = 3.

SCALE 2:  none = 0, passive = 1, active = 1, aggressive = 3, deadly = 6.

```{r}
ppb_force122$resist1_temp <- ppb_force122$resist1
ppb_force122$resist8_temp <- ppb_force122$resist8
ppb_force122$resist7_temp <- ppb_force122$resist7
ppb_force122$resist6_temp <- ppb_force122$resist6
ppb_force122$resist5_temp <- ppb_force122$resist5
ppb_force122$resist4_temp <- ppb_force122$resist4
ppb_force122$resist3_temp <- ppb_force122$resist3
ppb_force122$resist2_temp <- ppb_force122$resist2

ppb_force122$resist8_temp <- replace(ppb_force122$resist8_temp, ppb_force122$resist8_temp == "None", 0)
ppb_force122$resist8_temp <- replace(ppb_force122$resist8_temp, ppb_force122$resist8_temp == "Passive", 1)
ppb_force122$resist8_temp <- replace(ppb_force122$resist8_temp, ppb_force122$resist8_temp == "Active", 1)
ppb_force122$resist8_temp <- replace(ppb_force122$resist8_temp, ppb_force122$resist8_temp == "Aggressive", 2)
ppb_force122$resist8_temp <- replace(ppb_force122$resist8_temp, ppb_force122$resist8_temp == "Deadly", 4)

ppb_force122 %>%
  group_by(resist8_temp) %>%
  summarise(n())

ppb_force122$resist7_temp <- replace(ppb_force122$resist7_temp, ppb_force122$resist7_temp == "None", 0)
ppb_force122$resist7_temp <- replace(ppb_force122$resist7_temp, ppb_force122$resist7_temp == "Passive", 1)
ppb_force122$resist7_temp <- replace(ppb_force122$resist7_temp, ppb_force122$resist7_temp == "Active", 1)
ppb_force122$resist7_temp <- replace(ppb_force122$resist7_temp, ppb_force122$resist7_temp == "Aggressive", 2)
ppb_force122$resist7_temp <- replace(ppb_force122$resist7_temp, ppb_force122$resist7_temp == "Deadly", 4)

ppb_force122 %>%
  group_by(resist7_temp) %>%
  summarise(n())

ppb_force122$resist6_temp <- replace(ppb_force122$resist6_temp, ppb_force122$resist6_temp == "None", 0)
ppb_force122$resist6_temp <- replace(ppb_force122$resist6_temp, ppb_force122$resist6_temp == "Passive", 1)
ppb_force122$resist6_temp <- replace(ppb_force122$resist6_temp, ppb_force122$resist6_temp == "Active", 1)
ppb_force122$resist6_temp <- replace(ppb_force122$resist6_temp, ppb_force122$resist6_temp == "Aggressive", 2)
ppb_force122$resist6_temp <- replace(ppb_force122$resist6_temp, ppb_force122$resist6_temp == "Deadly", 4)

ppb_force122 %>%
  group_by(resist6_temp) %>%
  summarise(n())

ppb_force122$resist5_temp <- replace(ppb_force122$resist5_temp, ppb_force122$resist5_temp == "None", 0)
ppb_force122$resist5_temp <- replace(ppb_force122$resist5_temp, ppb_force122$resist5_temp == "Passive", 1)
ppb_force122$resist5_temp <- replace(ppb_force122$resist5_temp, ppb_force122$resist5_temp == "Active", 1)
ppb_force122$resist5_temp <- replace(ppb_force122$resist5_temp, ppb_force122$resist5_temp == "Aggressive", 2)
ppb_force122$resist5_temp <- replace(ppb_force122$resist5_temp, ppb_force122$resist5_temp == "Deadly", 4)

ppb_force122 %>%
  group_by(resist5_temp) %>%
  summarise(n())

ppb_force122$resist4_temp <- replace(ppb_force122$resist4_temp, ppb_force122$resist4_temp == "None", 0)
ppb_force122$resist4_temp <- replace(ppb_force122$resist4_temp, ppb_force122$resist4_temp == "Passive", 1)
ppb_force122$resist4_temp <- replace(ppb_force122$resist4_temp, ppb_force122$resist4_temp == "Active", 1)
ppb_force122$resist4_temp <- replace(ppb_force122$resist4_temp, ppb_force122$resist4_temp == "Aggressive", 2)
ppb_force122$resist4_temp <- replace(ppb_force122$resist4_temp, ppb_force122$resist4_temp == "Deadly", 4)

ppb_force122 %>%
  group_by(resist4_temp) %>%
  summarise(n())

ppb_force122$resist3_temp <- replace(ppb_force122$resist3_temp, ppb_force122$resist3_temp == "None", 0)
ppb_force122$resist3_temp <- replace(ppb_force122$resist3_temp, ppb_force122$resist3_temp == "Passive", 1)
ppb_force122$resist3_temp <- replace(ppb_force122$resist3_temp, ppb_force122$resist3_temp == "Active", 1)
ppb_force122$resist3_temp <- replace(ppb_force122$resist3_temp, ppb_force122$resist3_temp == "Aggressive", 2)
ppb_force122$resist3_temp <- replace(ppb_force122$resist3_temp, ppb_force122$resist3_temp == "Deadly", 4)

ppb_force122 %>%
  group_by(resist3_temp) %>%
  summarise(n())

ppb_force122$resist2_temp <- replace(ppb_force122$resist2_temp, ppb_force122$resist2_temp == "None", 0)
ppb_force122$resist2_temp <- replace(ppb_force122$resist2_temp, ppb_force122$resist2_temp == "Passive", 1)
ppb_force122$resist2_temp <- replace(ppb_force122$resist2_temp, ppb_force122$resist2_temp == "Active", 1)
ppb_force122$resist2_temp <- replace(ppb_force122$resist2_temp, ppb_force122$resist2_temp == "Aggressive", 2)
ppb_force122$resist2_temp <- replace(ppb_force122$resist2_temp, ppb_force122$resist2_temp == "Deadly", 4)

ppb_force122 %>%
  group_by(resist2_temp) %>%
  summarise(n())

ppb_force122$resist1_temp <- replace(ppb_force122$resist1_temp, ppb_force122$resist1_temp == "None", 0)
ppb_force122$resist1_temp <- replace(ppb_force122$resist1_temp, ppb_force122$resist1_temp == "Passive", 1)
ppb_force122$resist1_temp <- replace(ppb_force122$resist1_temp, ppb_force122$resist1_temp == "Active", 1)
ppb_force122$resist1_temp <- replace(ppb_force122$resist1_temp, ppb_force122$resist1_temp == "Aggressive", 2)
ppb_force122$resist1_temp <- replace(ppb_force122$resist1_temp, ppb_force122$resist1_temp == "Deadly", 4)

ppb_force122 %>%
  group_by(resist1_temp) %>%
  summarise(n())

ppb_force122$resist1_temp <- as.numeric(ppb_force122$resist1_temp)
ppb_force122$resist8_temp <- as.numeric(ppb_force122$resist8_temp)
ppb_force122$resist7_temp <- as.numeric(ppb_force122$resist7_temp)
ppb_force122$resist6_temp <- as.numeric(ppb_force122$resist6_temp)
ppb_force122$resist5_temp <- as.numeric(ppb_force122$resist5_temp)
ppb_force122$resist4_temp <- as.numeric(ppb_force122$resist4_temp)
ppb_force122$resist3_temp <- as.numeric(ppb_force122$resist3_temp)
ppb_force122$resist2_temp <- as.numeric(ppb_force122$resist2_temp)

class(ppb_force122$resist1_temp)
class(ppb_force122$resist8_temp)
class(ppb_force122$resist7_temp)
class(ppb_force122$resist6_temp)
class(ppb_force122$resist5_temp)
class(ppb_force122$resist4_temp)
class(ppb_force122$resist3_temp)
class(ppb_force122$resist2_temp)

```
Create permanent variable **resistN_geomindex2**

```{r}
ppb_force122$resist1_geomindex2 <- ppb_force122$resist1_temp
ppb_force122$resist8_geomindex2 <- ppb_force122$resist8_temp
ppb_force122$resist7_geomindex2 <- ppb_force122$resist7_temp
ppb_force122$resist6_geomindex2 <- ppb_force122$resist6_temp
ppb_force122$resist5_geomindex2 <- ppb_force122$resist5_temp
ppb_force122$resist4_geomindex2 <- ppb_force122$resist4_temp
ppb_force122$resist3_geomindex2 <- ppb_force122$resist3_temp
ppb_force122$resist2_geomindex2 <- ppb_force122$resist2_temp

ppb_force122 %>%
  group_by(resist1_geomindex2) %>%
  summarise(n())
```
```{r}
#remove the temp vars
ppb_force122 <- select(ppb_force122, - c(resist1_temp, resist8_temp, resist7_temp, resist6_temp, resist5_temp, resist4_temp, resist3_temp, resist2_temp))
```

```{r}

ls(ppb_force122)
```


**THREAT VARIABLES**

Threat variables record various kind of aggressive behaviors, passive resistance, and weapons used, brandished, or possessed by civilians. NA in the raw data really means zero, no such threat observed or expected. After changing NA to 0 in each variable, I will create a count variable to tally up the number of aggressive threats brandished by civilians.


**"threat_biohaz"**

```{r}
ppb_force122 %>%
  group_by(threat_biohaz_raw) %>%
  summarise(n())
```

```{r}
#ppb_force122$threat_biohaz_raw <- ifelse(is.na(ppb_force122$threat_biohaz_raw), ppb_force122$threat_biohaz_raw == 0, ppb_force122$threat_biohaz_raw == 1)

#ppb_force122$threat_biohaz_raw <- replace(ppb_force122$threat_biohaz_raw, ppb_force122$threat_biohaz_raw == FALSE, 1)

ppb_force122$threat_biohaz_raw <- ppb_force122$threat_biohaz_raw %>% 
  replace_na(0)


ppb_force122$threat_biohaz_raw <- replace(ppb_force122$threat_biohaz_raw, ppb_force122$threat_biohaz_raw == "Needle / Spit / Bodily Fluids", 1)


ppb_force122 %>%
  group_by(threat_biohaz_raw) %>%
  summarise(n())
```

That worked. Now create permanent var:

```{r}
ppb_force122$threat_biohaz <- as.numeric(ppb_force122$threat_biohaz_raw)
```

**"threat_blunt"**

```{r}
ppb_force122 %>%
  group_by(threat_blunt_raw) %>%
  summarise(n())
```

```{r}
ppb_force122$threat_blunt_raw <- ppb_force122$threat_blunt_raw %>% 
  replace_na(0)


ppb_force122$threat_blunt_raw <- replace(ppb_force122$threat_blunt_raw, ppb_force122$threat_blunt_raw == "Blunt Object", 1)

ppb_force122 %>%
  group_by(threat_blunt_raw) %>%
  summarise(n())
```

That worked. Now create permanent var:

```{r}
ppb_force122$threat_blunt <- as.numeric(ppb_force122$threat_blunt_raw)
```

**"threat_gun"**

```{r}
ppb_force122 %>%
  group_by(threat_gun_raw) %>%
  summarise(n())
```

```{r}
ppb_force122$threat_gun_raw <- ppb_force122$threat_gun_raw %>% 
  replace_na(0)


ppb_force122$threat_gun_raw <- replace(ppb_force122$threat_gun_raw, ppb_force122$threat_gun_raw == "Firearm", 1)

ppb_force122 %>%
  group_by(threat_gun_raw) %>%
  summarise(n())
```

That worked. Now create permanent var:

```{r}
ppb_force122$threat_gun <- as.numeric(ppb_force122$threat_gun_raw)
```



**"threat_gun_implied"**

```{r}
ppb_force122 %>%
  group_by(threat_gun_implied_raw) %>%
  summarise(n())
```

```{r}

ppb_force122$threat_gun_implied_raw <- ppb_force122$threat_gun_implied_raw %>% 
  replace_na(0)


ppb_force122$threat_gun_implied_raw <- replace(ppb_force122$threat_gun_implied_raw, ppb_force122$threat_gun_implied_raw == "Firearm - Implied", 1)

ppb_force122 %>%
  group_by(threat_gun_implied_raw) %>%
  summarise(n())
```

That worked.

Now create permanent var:

```{r}
ppb_force122$threat_gun_implied <- as.numeric(ppb_force122$threat_gun_implied_raw)
```

**"threat_gun_replica"**

```{r}
ppb_force122 %>%
  group_by(threat_gun_replica_raw) %>%
  summarise(n())
```

```{r}
ppb_force122$threat_gun_replica_raw <- ppb_force122$threat_gun_replica_raw %>% 
  replace_na(0)


ppb_force122$threat_gun_replica_raw <- replace(ppb_force122$threat_gun_replica_raw, ppb_force122$threat_gun_replica_raw == "Firearm - Replica", 1)

ppb_force122 %>%
  group_by(threat_gun_replica_raw) %>%
  summarise(n())
```

That worked. Now create permanent var:

```{r}
ppb_force122$threat_gun_replica <- as.numeric(ppb_force122$threat_gun_replica_raw)
```

**"threat_knife"**

```{r}
ppb_force122 %>%
  group_by(threat_knife_raw) %>%
  summarise(n())
```


```{r}

ppb_force122$threat_knife_raw <- ppb_force122$threat_knife_raw %>% 
  replace_na(0)


ppb_force122$threat_knife_raw <- replace(ppb_force122$threat_knife_raw, ppb_force122$threat_knife_raw == "Knife / Edged Weapon / Stabbing Instrument", 1)

ppb_force122 %>%
  group_by(threat_knife_raw) %>%
  summarise(n())
```

That worked. Now create permanent var:

```{r}
ppb_force122$threat_knife <- as.numeric(ppb_force122$threat_knife_raw)
```

**"threat_other"**

```{r}
ppb_force122 %>%
  group_by(threat_other_raw) %>%
  summarise(n())
```

This looks like a free text transcription. Would have to be collapse-coded by hand every time new data added to the dataset. But there are some important categories in here, like reach for officer's gun, vehicle, and biting, could search on that string, it is by far the largest category...

Let's just convert all strings to 1, and all NA to 0.

```{r}

ppb_force122$threat_other_raw <- ifelse(is.na(ppb_force122$threat_other_raw), ppb_force122$threat_other_raw == "zero", ppb_force122$threat_other_raw == "one")

ppb_force122$threat_other_raw <- replace(ppb_force122$threat_other_raw, ppb_force122$threat_other_raw == FALSE, 1)

ppb_force122$threat_other_raw <- ppb_force122$threat_other_raw %>% 
  replace_na(0)
```

```{r}
ppb_force122 %>%
  group_by(threat_other_raw) %>%
  summarise(n())
```

Now create permanent newvar:

```{r}
ppb_force122$threat_other <- as.numeric(ppb_force122$threat_other_raw)

ppb_force122 %>%
  group_by(threat_other, threat_other_raw) %>%
  summarise(n())

```

**"threat_unused_weapon"**

```{r}
ppb_force122 %>%
  group_by(threat_unused_weapon_raw) %>%
  summarise(n())
```

Looks like the varname, passive, could be confusing. This is really civilians who were armed but did not use their weapons. It is a large category. Will change to "threat_unused_weapon".

Change to a 1/0 var:

```{r}
ppb_force122$threat_unused_weapon_raw <- replace(ppb_force122$threat_unused_weapon_raw, ppb_force122$threat_unused_weapon_raw == "Weapon Present or reported but not used or threatened use", 1)

ppb_force122$threat_unused_weapon_raw <- ppb_force122$threat_unused_weapon_raw %>% 
  replace_na(0)
```

```{r}
ppb_force122 %>%
  group_by(threat_unused_weapon_raw) %>%
  summarise(n())
```

That worked! Let's convert to a permanent var:

```{r}
ppb_force122$threat_unused_weapon <- as.numeric(ppb_force122$threat_unused_weapon_raw)

ppb_force122 %>%
  group_by(threat_unused_weapon, threat_unused_weapon_raw) %>%
  summarise(n())
```

**"threat_unarmed"**

```{r}
ppb_force122 %>%
  group_by(threat_unarmed_raw) %>%
  summarise(n())
```

Needs conversion to 0/1 var.

```{r}
ppb_force122$threat_unarmed_raw <- replace(ppb_force122$threat_unarmed_raw, ppb_force122$threat_unarmed_raw == "No weapon (unarmed)", 1)

ppb_force122$threat_unarmed_raw <- ppb_force122$threat_unarmed_raw %>% 
  replace_na(0)

ppb_force122 %>%
  group_by(threat_unarmed_raw) %>%
  summarise(n())
```

UPDATE:  THIS IS TRICKY BECAUSE IF YOU ADD UP ALL THE PERSONS WHO PRESENTED AN ACTIVE THREAT, YOU GET A SUBSTANTIALLY HIGHER NUMBER OF UNARMED THAN OFFICERS CHECKED OFF AS UNARMED. HOWEVER, IF YOU ADD IN PERSONS WHO HAD A WEAPON BUT DID NOT USE IT, YOU GET AN UNARMED COUNT THAT IS CLOSE OR EQUAL TO THE ABOVE.  Let's create a permanent var based on this transformation:

```{r}
ppb_force122$threat_unarmed <- as.numeric(ppb_force122$threat_unarmed_raw)

ppb_force122 %>%
  group_by(threat_unarmed, threat_unarmed_raw) %>%
  summarise(n())
```

*threat_active_kinds_sum*

Now let's create a variable that sums the number of UPDATE: KINDS OF threats per officer-civilian interaction, limited to ACTIVE threats, i.e., omitting unarmed, and weapons possessed but unused.

```{r}
ls(ppb_force122)
```


```{r}

ppb_force122$threat_active_kinds_sum <- as.numeric(ppb_force122$threat_biohaz) + as.numeric(ppb_force122$threat_blunt) + as.numeric(ppb_force122$threat_gun) + as.numeric(ppb_force122$threat_gun_implied) + as.numeric(ppb_force122$threat_gun_replica) + as.numeric(ppb_force122$threat_knife) + as.numeric(ppb_force122$threat_other) 

ppb_force122 %>%
   group_by(threat_active_kinds_sum) %>%
   summarise(n())
```

UPDATE: REALLY, THE ZERO IS THE ONLY INTERESTING VALUE OF THIS VARIABLE.  IT REPRESENTS THE NUMBER OF OFFICERS WHO FACED NO ACTIVE THREAT (AND THE FDCR LEVEL, THAT IS)

**CREATE PERMANENT CLEAN ppb_force122 DATASET**


Let's list all the variables in ppb_force122 to make sure all raw vars have been cleaned and wrangled to vars without the _raw suffix.

```{r}
ls(ppb_force122)
```
UPDATE; FOR Q1 2022 DATA, ALL RAW VARS HAVE A PERMANENT COUNTERPART.  OK TO DELETE THE RAWS AND CREATE A PERMANENT FDCR DATASET.

**NOw DROP THE RAW VARIABLES AND CREATE NEW CLEAN PPB USE OF FORCE DATASET, with vars grouped by type**

```{r}

ppbforce_clean_q122 = ppb_force122[,!grepl("_raw$", names(ppb_force122))]

ppbforce_clean_q122 = select(ppbforce_clean_q122, starts_with("call"), starts_with("civil"),starts_with("force"),starts_with("incid"),starts_with("officer"),starts_with("resist"), starts_with("threat"),starts_with("record"))

ls(ppbforce_clean_q122)
```

Success. \_raw variables removed, permanent variables retained.  UPDATE: NOW SORT VARS BY NAME...

```{r}
ppbforce_clean_q122 <- ppbforce_clean_q122 %>%                       # Sort with dplyr
  select(sort(names(.)))

head(ppbforce_clean_q122, L=5)
```

The reordering worked. 


**NOW, PERMANENTLY SAVE *ppbforce_clean_q321***

```{r}
#remove(ppb_force122)  APPARENTLY, THE PRIOR COMMAND ALSO REMOVED PPB_FORCE122

save(ppbforce_clean_q122, file = "ppbforce_clean_q122.RData")

write.csv(ppbforce_clean_q122, file = "ppbforce_clean_q122.csv")
```


**NOTES**

When you save this or any RMarkdown notebook, an HTML file containing the code and output will be saved alongside it. (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview renders an HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
